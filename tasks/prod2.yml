---
- name: install the .env file
  template:
    src: env
    dest: "{{ site_build_path }}/{{ site_repo_name }}/.env"

- name: sync manage.py to deployment path
  command: rsync -av {{ site_build_path }}/manage.py {{ site_deployment_path }}/
  sudo: yes

- name: sync project code to deployment path
  command: rsync -avz --delete {{ site_build_path }}/{{ site_repo_name }} {{ site_deployment_path}}/
  sudo: yes

- name: delete the cloned project
  file:
    path: "{{ site_build_path }}"
    state: absent
  sudo: yes

- name: append app_user_group to groups of www-data
  user:
    name: www-data
    groups: "{{ site_app_group }}"
    append: yes
  notify:
    - restart nginx
  sudo: yes

